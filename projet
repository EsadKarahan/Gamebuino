// diminuer la vitesse player et mob ??

#include <Gamebuino-Meta.h>

const int PLAYER_SIZE = 5; // taille du cercle "personnage_principal"
const int MOB_SIZE = 5; // taille des carrés "mobs"
const float MOB_SPEED = 1; // vitesse de déplacement des carrés "mobs"
const int MOB_INTERVAL = 80; // intervalle de génération des carrés "mobs"

int player_x; // position x du cercle "personnage_principal"
int mob_count; // nombre de carrés "mobs" actuellement à l'écran

struct Mob {
  int x, y;
};

Mob mobs[2]; // tableau contenant les positions des carrés "mobs"

void setup() {
  gb.begin();
  player_x = gb.display.width() / 2;
}

void update_player() {
  if (gb.buttons.repeat(BUTTON_LEFT, 0) && player_x > PLAYER_SIZE / 2) {
    player_x -= 1;
  }
  if (gb.buttons.repeat(BUTTON_RIGHT, 0) && player_x < gb.display.width() - PLAYER_SIZE / 2) {
    player_x += 1;
  }
}

void draw_player() {
  gb.display.setColor(WHITE);
  gb.display.fillCircle(player_x, gb.display.height() - PLAYER_SIZE, PLAYER_SIZE / 2);
}

void update_mobs() {
  for (int i = 0; i < mob_count; i++) {
    mobs[i].y += MOB_SPEED; // vitesse divisée par 2
    if (mobs[i].y > gb.display.height() + MOB_SIZE / 2) {
      mobs[i] = mobs[mob_count - 1];
      mob_count--;
      i--;
    }
  }
  if (gb.frameCount % MOB_INTERVAL == 0 && mob_count < 3) { // nombre maximum réduit à 3
    mobs[mob_count] = {(int)(rand() % (gb.display.width() - MOB_SIZE)) + MOB_SIZE / 2, 0};
    mob_count++;
  }
}

void draw_mobs() {
  gb.display.setColor(WHITE);
  for (int i = 0; i < mob_count; i++) {
    gb.display.drawRect(mobs[i].x - MOB_SIZE / 2, mobs[i].y - MOB_SIZE / 2, MOB_SIZE, MOB_SIZE);
  }
}

void update() {
  update_player();
  update_mobs();
}

void draw() {
  gb.display.clear();
  draw_player();
  draw_mobs();
}

void loop() {
  update();
  draw();
  gb.update();
}